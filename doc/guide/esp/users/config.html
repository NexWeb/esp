<!-- BeginDsi "dsi/head.html" -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Embedthis ESP 5.0.0-rc0 Documentation</title>
    <meta name="keywords" content="web framework, embedded web server, application web server, 
        embedded server, small web server, HTTP server, node, nginx, appweb" />
    <meta name="description" content="Embedthis Sofware provides commercial and open source embedded web 
        technology for devices and applications." />
	<meta name="robots" content="index,follow" />
	<link href="../../../doc.css" rel="stylesheet" type="text/css" />
	<link href="../../../print.css" rel="stylesheet" type="text/css" media="print"/>
    <!--[if IE]>
    <link href="../../../iehacks.css" rel="stylesheet" type="text/css" />
    <![endif]-->
    <link href="http://www.google.com/cse/style/look/default.css" type="text/css" rel="stylesheet" />
</head>

<body>
    <div class="top">
        <a class="logo" href="http://embedthis.com/">&nbsp;</a>
        <div class="topRight">
            <div class="search">
                <div id="cse-search-form"></div>
                <div class="version">Embedthis ESP 5.0.0-rc0</div>
            </div>
        </div>
        <div class="crumbs">
            <a href="../../../index.html">Home</a>
<!-- EndDsi -->
             &gt;<a href="index.html">User Guide</a> &gt;
            <b>ESP</b>
        </div>
    </div>
    <div class="content">
        <div class="contentRight">
            <h1>Quick Nav</h1>
            <ul class="nav">
                <li><a href="#module">ESP Module</a></li>
                <li><a href="#handler">ESP Handler</a></li>
                <li><a href="#errors">Error Handling</a></li>
                <li><a href="#reload">Reloading</a></li>
                <li><a href="#keep">Keep Source</a></li>
                <li><a href="#mvc">MVC Applications</a></li>
                <li><a href="#routing">ESP Routes</a></li>
                <li><a href="#database">Databases</a></li>
                <li><a href="#compilation">Compilation</a></li>
                <li><a href="#directives">Directives</a></li>
            </ul>
<!-- BeginDsi "dsi/userGuideSeeAlso.html" -->
            <h1>See Also</h1>
            <ul class="nav">
                <li><a href="../../../guide/esp/users/index.html">ESP Overview</a></li>
                <li><a href="../../../guide/esp/users/mvc.html">MVC Framework</a></li>
                <li><a href="../../../guide/esp/users/config.html">Configuring ESP</a></li>
                <li><a href="../../../guide/esp/users/pages.html">ESP Pages and Layouts</a></li>
                <li><a href="../../../guide/esp/users/controllers.html">ESP Controllers</a></li>
                <li><a href="../../../guide/esp/users/program.html">ESP Program</a></li>
                <li><a href="../../../guide/esp/users/database.html">ESP Database Interface</a></li>
                <li><a href="../../../guide/esp/start/pages-tour.html">ESP Page Tour</a></li>
                <li><a href="../../../guide/esp/start/mvc-tour.html">ESP MVC Tour</a></li>
              </ul>
<!-- EndDsi -->
        </div>
        <div class="contentLeft">
            <h1>Configuring ESP</h1>
            <p>ESP applications are configured via a <em>package.json</em> file.
            This is a JSON property file that is made available to server-side 
            controllers and pages, and portions are provided to client-side scripts.</p>
            <p>The package.json describes and configures:</p> 
            <ul>
                <li>Application name, version and description</li>
                <li>Directory locations and structure</li>
                <li>Extension packages and dependencies</li>
                <li>Client-side scripts</li>
                <li>Execution mode: debug or release</li>
                <li>Response Caching</li>
                <li>Application timeouts</li>
                <li>Error handling</li>
                <li>Database name and location</li>
                <li>Application compilation policy</li>
                <li>Default data formats</li>
            </ul>
            <p>This document will cover the various package.json properties and the steps to 
                configure ESP applications.</p>
            <p>If you need to do more complex routing of URIs or more granular control of authentication, you may
                need to specify additional routes in an <em>appweb.conf</em> configuration file. For details, see
            <a href="appweb.html">Configuring ESP in Appweb</a>.</p>
            <h2>Package.json</h2>
            <p>The package.json schema is defined by the <a href="http://embedthis.com/products/pak/">Pak</a>
            package manager and conforms to the <a href="http://wiki.commonjs.org/wiki/Packages/1.1">CommonJS
            Packages 1.1</a> specification. One package.json file is used for the ESP application itself and 
            each installed extension package will have its own package.json file. This permits <em>esp</em>
            to easily manage installed packages and dependencies.</p>
            <p>The <em>esp</em> manager program contains a subset of the 
            <a href="http://embedthis.com/products/pak/">Pak</a> package manager.
            As such, it can install, list, uninstall and upgrade packages. You can use either <em>esp</em> or
            <em>pak</em> to install, uninstall or upgrade paks for your application.</p>
            <p>Here is a quick look at a package.json file. The <em>esp</em> property section (in yellow)
            if specific to ESP. The other properties are generic to any package using the Pak package manager.</p>
<pre>{
    "name": "blog",
    "title": "My Blog",
    "description": "My blog with thoughts and tales from my travels in Africa",
    "version": "1.2.0",
    "dependencies": {
        "esp-server": "1.x",
    },
    "client-scripts": [
        "app/**.js*",
    ],
    <b>esp: {
        server: {
            redirect: "secure"
            database: "mdb://blog.mdb"
        },
        showErrors: true,
        update: true,
    }</b>,
},</pre>
            <h3>Creating a package.json file</h3>
            <p>When serving stand-alone <em>esp</em> pages, you do not need a package.json file, ESP has
            sensible defaults and you can just run esp to serve pages. 
            <pre>$ <b>esp run</b></pre>
            <p>However, when creating more complex applications, you will need a package.json
            to store your application configuration.</p>
            <p>To create a package.json, you can either run <em>esp init</em> or you can install one or more
            ESP paks and the package.json will be created automatically.</p>
            <pre><b>esp init</b></pre> 
            <p>This will create a default package.json using the name of the current directory as the application 
            name. For example:</p>
            <pre>{
    "name": "test",
    "title": "test",
    "description": "test",
    "version": "0.0.0",
    "dependencies": {},
    "client-scripts": [],
    "dirs": {}
}</pre>
            <p>Alternatively, a package.json will be created if you install one more more packs</p>
            <pre><b>esp install esp-html-mvc</b></pre>
            <a id="mode"></a>
            <h3>Execution Mode</h3>
            <p>ESP provides a convenient way to select a set of properties that correspond to a desired execution
            mode. Example modes are: <em>debug</em>, <em>test</em> or <em>release</em>. In each mode, different
            compilation, logging, authentication, and timeout parameters may be required. The <em>esp.mode</em>
            property specifies a collection of properties that will be copied to the top-level esp collection
            before the application runs. By modifying the <em>esp.mode</em> setting, an entirely different 
            execution configuration may be selected. ESP makes this easy via the command:</p>
            <pre>esp mode NAME</pre> 
            <p>Where NAME is set to a collection of properties in the package.json to copy. This is typically
                <em>debug</em> or <em>release</em>.</p>
            <a id="errors"></a>
            <h3>Error Handling</h3>
            <p>If an ESP page has a syntax error or a run-time error, messages will be sent to the ESP log file.
            This defaults to the console, but can be sent elsewhere by invoking esp with the <em>--log</em> option.</p>
            <p>Often during development, it is useful to send errors back to the browser. To do this, 
            set the <em>esp.showErrors</em> property to true: </p>
            <pre>esp set esp.showErrors true</pre>
            <a id="reload"></a>
            <h3>Reloading</h3>
            <p>ESP supports an "edit-and-continue" development style where you can make modifications to 
            ESP controllers and pages and when you click reload in your browser, the controller or page 
            will be transparently recompiled and reloaded. This can be a great boost for development productivity.</p>
            <p>If your ESP application is running in debug mode, then ESP
            will automatically rebuild modified ESP pages and controllers. If your ESP application is 
            running release mode, the default is to not reload. 
            This default behavior can be modified via the <em>esp.mode</em> setting. For example:</p>
            <pre>esp mode debug</pre>
            <a id="keep"></a>
            <h3>Keep Source</h3>
            <p>Sometimes, it is helpful to preserve intermediate "C" source files so that you can debug
            your application at the source code level. When an ESP page is parsed, it is blended with a 
            layout page and then an intermediate C source file is generated. 
            This is normally removed after compilation. Setting the
            <em>esp.keepSource</em> property to "<em>true</em>" will cause ESP to preserve this 
            intermediate source file in the <em>cache</em> directory.</p>
            <pre>esp set esp.keepSource true</pre>
             <a id="database"></a>
            <h2 class="section">Databases</h2>
            <p>Databases can be specified and pre-opened via the <em>esp.server.database</em> property 
                in the <em>package.json</em>. <p>The database property takes the form: 
                <em>provider://database-connection</em>. For example:</p>
<pre>
    database: "mdb://blog.mdb"
or
    database "sdb://sqlite.sdb"
</pre>
                <p>For SQLite and MDB databases, the database-connection string is the name of the database in the ESP
                <em>db</em> directory.</p>
                <p>ESP supports multiple database engines through a single Embedded Database Interface. 
                Support is included for SQLite and MDB. See <a href="database.html">Database Interface</a> 
                for more information about Database Support.</p>
            <a id="pages"></a>
            <h2>ESP Pages</h2>
            <p>There is no additional configuration require to support ESP pages. If you only wish to stand-alone
            ESP pages, a package.json is not even required.</p>
            <h4>Layouts</h4>
            <p>Layout pages define a common look and feel for the application and provide the "outer" content for
            every page. If you do not define a layout page, the ESP pages will be served as-is.
            If you create a <em>layouts/default.esp</em> layout page, it will be used to wrap the ESP page.  
            <p>You can select a different layout page via the <em>layout</em> directive at the top of an ESP page.
            For example:</p>
                <pre>&lt;% layout "mylayout.esp" %&gt;</pre>
            <h2 class="section">ESP Package.json Properties</h2>
            <h3>Top Level Properties</h3>
            <table title="top-level collections" class="full">
                <thead>
                    <tr><th>Name</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>name</td>
                        <td>One word application name.</td>
                    </tr>
                    <tr>
                        <td>title</td>
                        <td>Multi-word application name to display.</td>
                    </tr>
                    <tr>
                        <td>description</td>
                        <td>Sort-sentance description of the application.</td>
                    </tr>
                    <tr>
                        <td>version</td>
                        <td>Application version conforming to <a href="http://semver.org">SemVer</a>.</td>
                    </tr>
                    <tr>
                        <td>keywords</td>
                        <td>Descriptive keywords that Pak can use if the application is published in the
                            <a href="http://embedthis.com/catalog/">Pak catalog</a>.</td>
                    </tr>
                    <tr>
                        <td>dependencies</td>
                        <td>Other paks the application requires. The key is the pak name and the value
                            is a version expression. See
                            <a href="https://embedthis.com/products/pak/doc/index.html">Pak Documentation for
                            details.</a></td>
                    </tr>
                    <tr>
                        <td>client-scripts</td>
                        <td>Scripts to send to the client when parsing the ESP <em>scripts()</em> API. This may
                        include the "*" wildcard to match any file or "**" to match any file in any directory.</td>
                    </tr>
                    <tr>
                        <td>dirs</td>
                        <td>Directory locations for ESP: 
                        <ul>
                            <li>client &mdash; Directory containing client-side content. All files under this 
                                directory are visible to the client.</li>
                            <li>paks &mdash; Directory to contain installed Paks. Defaults to ./paks, 
                               however this must typically be set to client/paks for many common ESP paks.</li>
                            <li>pakscache &mdash; Location of the per-user Pak cache. Defaults to ~/.paks.</li>
                        </ul>
                    </tr>
                    <tr>
                        <td>esp</td>
                        <td>ESP specific configuration.</td>
                    </tr>
                    <tr>
                        <td>ignore</td>
                        <td>File patterns to ignore when installing the application or package.</td>
                    </tr>
                </tbody>
            </table>
            <h3>Dependency Expressions</h3>
            <p>Dependent packs may be specified in the <em>dependencies</em> property. This is an object 
            collection of paks with version expressions. When esp installs a new pak, an entry for the new pak
            will be added to the dependency collection. For example:</p>
            <pre>"dependencies": {
    "angular": "1.2.0",
    "bootstrap": "3.0.0",
}</pre>
            <h4>Dependency Versions</h4>
            <p>ESP versions comply with the <a href="http://semver.org">SemVer</a> version specification.
            Briefly, this means versions are expressed :</p>
            <pre>MAJOR.MINOR.PATCH-PRERELEASE</pre> 
            <p>Dependency versions may also include expressions that describe a range of acceptable pak versions.</p>
            <ul>
                <li>version &mdash; (allows prereleases)</li>
                <li>^ version &mdash; (same as >=1.2.3 &lt;2.0.0, does not allow prereleases)</li>
                <li>~ version &mdash; (same as >=1.2.3 &lt;2.0.0, allows prereleases)</li>
                <li>1.2.X &mdash; (any version starting with 1.2 (allows prereleases)</li>
                <li>[&gt;, &gt;=, &lt;, &lt;=, ==, !=] version</li>
                <li>expression || expression ... (either expression qualifies)</li>
                <li>expression &amp;&amp; expression ... (both expressions must qualify)</li>
                <li>expression expression ... (same as &amp;&amp;) </li>
                </li>
            </ul>
            <p>For example:</p>
                        <pre>"dependencies": {
    "angular": ">=1.2.0",  /* Versions 1.2.0 or later including prereleases */
    "bootstrap": "~3",     /* Versions 3.0.0 or later including prereleases */
    "jquery": "^1.9.1",    /* Version 1.9.1 and not prereleases */
    "less": "1.3.x",       /* Version 1.3.x and prereleases /
}</pre>
            <h3>ESP Configuration &mdash; esp.*</h3>
            <table title="top-level collections" class="full">
                <thead>
                    <tr><th>Name</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>server</td>
                        <td>Collection of server side configuration that will not be passed to the client.</td>
                    </tr>
                    <tr>
                        <td>mode</td>
                        <td>Execution mode for the application. Typically <em>debug</em> or <em>release</em>
                        but can be any identifier word. This selects a property collection of the same name
                        and copies those properties up one level.</td>
                    </tr>
                    <tr>
                        <td>serverPrefix</td>
                        <td>URI prefix to communicate with server-side controllers for the application.</td>
                    </tr>
                    <tr>
                        <td>auth</td>
                        <td>Authentication policy. Set to "basic", digest", or "app" for web form authentication.</td>
                    </tr>
                    <tr>
                        <td>formats</td>
                        <td>Collection of properties defining default data formats. Used by esp-angular-mvc.
                        <ul>
                            <li>date &mdash; Default date format string. For example: "yyyy-MM-dd"</li>
                            <li>float &mdash; Default number of decimal places to display.</li>
                        </ul>
                    </tr>
                    <tr>
                        <td>json</td>
                        <td>Controls if controller responses should be sent in JSON instead of HTML.</td>
                    </tr>
                    <tr>
                        <td>refresh</td>
                        <td>Default period for to refresh client data in dynamic web pages.</td>
                    </tr>
                    <tr>
                        <td>xsrf</td>
                        <td>Control if an XSRF anti-forgery token is used on forms.</td>
                    </tr>
                    <tr>
                        <td>timeouts</td>
                        <td>Collection of timeouts. Currently only a <em>session</em> timeout is supported.
                        The timeout units are in seconds.</td>
                    </tr>
                    <tr>
                        <td>combined</td>
                        <td>Controls if the application is to be compiled in <em>combined</em> mode where
                        all the application is compiled into a single library binary.</td>
                    </tr>
                    <tr>
                        <td>showErrors</td>
                        <td>Controls if application errors should be displayed in the browser.
                        Set to true to display errors in the browser.</td>
                    </tr>
                    <tr>
                        <td>keepSource</td>
                        <td>Set to true to keep intermediate source for views in the cache directory. This can
                        be an aide for debugging.</td>
                    </tr>
                    <tr>
                        <td>login</td>
                        <td>Collection of login related properties.</td>
                    </tr>
                    <tr>
                        <td>update</td>
                        <td>Controls if updated ESP controllers and pages will be recompiled and if 
                            updated ESP modules will be reloaded. Set to true to enable.</td>
                    </tr>
                </tbody>
            </table>
            <h3>Server Collection &mdash; esp.server.*</h3>
            <table title="top-level collections" class="full">
                <thead>
                    <tr><th>Name</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>database</td>
                        <td>Datebase to create and open for the application. Of the form:
                            <em>provider://name.ext</em> where provider is set to either "mdb" for the
                            embedded memory database or "sdb" for SQLite. The extensions are "mdb" or "sdb"
                            by convention.</td>
                    </tr>
                    <tr>
                        <td>generate</td>
                        <td>Collection of properties guiding the <em>esp generate</em> commands.</td>
                    </tr>
                    <tr>
                        <td>redirect</td>
                        <td>If set to "<em>secure</em>", then all access over HTTP will be redirected over HTTPS
                        which uses SSL/TLS for encrypted secure communications.</td>
                    </tr>
                </tbody>
            </table>
            <h3>Login Collection &mdash; esp.login.*</h3>
            <table title="top-level collections" class="full">
                <thead>
                    <tr><th>Name</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>name</td>
                        <td>Automatically login as this user with the role defined by set of <em>abilities</em>.</td>
                    </tr>
                    <tr>
                        <td>abilities</td>
                        <td>Property collection of abilites for the user specified via <em>name</em>.
                        Abilities are simple words that define capabilies. ESP controllers and pages 
                        can require that certain abilities be present before authorizing access.</td>
                    </tr>
                    <tr>
                        <td>single</td>
                        <td>Set to true to permit only one simultaneous login. Ideal for some management user
                        interfaces.</td>
                    </tr>
                </tbody>
            </table>
            
        </div>
    </div>
<!-- BeginDsi "dsi/bottom.html" -->
	<div class="bottom">
		<p class="footnote"> 
            <a href="../../../product/copyright.html" >&copy; Embedthis Software LLC, 2003-2014.
            All rights reserved. Embedthis ESP is a trademark of Embedthis Software LLC.</a>
		</p>
	</div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript"> 
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
        var customSearchControl = new google.search.CustomSearchControl(
          '000262706376373952077:1hs0lhenihk');
        customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
        var options = new google.search.DrawOptions();
        options.enableSearchboxOnly("http://embedthis.com/search.html");
        customSearchControl.draw('cse-search-form', options);
      }, true);
    </script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-179169-2']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
